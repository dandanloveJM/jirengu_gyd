<!DOCTYPE html>
<html>  
    <head>
        <title>木桶布局</title>
        <meta charset="utf-8">
        <style>
        * {
            padding: 0;
            margin: 0;
        }
        .img-container {
            width: 1000px;
            margin: 0 auto;
        }
        .img-row:after {
            content:'';
            display: block;
            clear: both;
        }
        .img-box {
            float: left;
            margin-right: 8px;
        }
        </style>
    </head>
    <body>
        <div class="img-container">
            
        </div>
    </body>
    <script src="jquery-3.2.0.min.js"></script>
    <script>
    var rowList = [] //构造数组
    var imageIndex
     var flag = true
    function getImgUrl(num){
        var urls = [],
            width, height
        
        for(var i = 0; i < num; i++){
            width = Math.floor(Math.random()*300 + 100)
            height = 200
            urls.push("https://unsplash.it/" + width + '/' + height)
           
        }

        return urls
    }
    function loadImage(){
        var imgUrls = getImgUrl(60)
     

        $.each(imgUrls, function(index, url){
            console.log('index是'+ index)
            var img = new Image()
            img.src = url
            img.onload = function(){
                var imgInfo = {
                    target: img,
                    width: parseInt(200 * (img.width/img.height)),
                    height: 200
                }
                
                render(imgInfo) //根据图片宽高进行排布
                imageIndex = index
             
            }
        })
    }
        
        function render(imgInfo){
           console.log(imgInfo.width)
            var clientWidth = $('.img-container').width()//父容器的宽度
            
            var rowWidth = 0 //每一行已经放入数组的元素的宽度之和
            var lastImgInfo = imgInfo
            var newRowHeight = 0
            var ratio
            
            rowList.push(imgInfo)
            //遍历数组的每一个元素

            for(var i = 0; i < rowList.length; i++){
                rowWidth += rowList[i].width + 8
       
            }
            if(rowWidth > clientWidth){//如果数组的宽度大于容器的宽度

            
                rowList.pop()//将最后一个元素取出来，并且排布前面的元素

                var nowRowWidth = rowWidth - imgInfo.width  
                ratio = nowRowWidth/(clientWidth)
                
                newRowHeight = 200/ratio
                 var $rowCt = $('<div class="img-row"></div>');
                $.each(rowList, function(index, imgInfo){
                    var $imgCt = $('<div class="img-box"></div>')
            
                    var $img = $(imgInfo.target)
                    console.dir(imgInfo.target)
                    $img.width(parseInt(imgInfo.width/ratio))
                    console.log('宽度是'+ imgInfo.width)
                    $img.height(newRowHeight)
                    $imgCt.append($img);
                    $rowCt.append($imgCt);
                })

                $('.img-container').append($rowCt)
                
                rowList = []
                rowList.push(lastImgInfo)
                flag = false
            }
            

        }
        
    
   
    loadImage()
  
    
    </script>
</html>